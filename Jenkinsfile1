pipeline {
    agent any

    tools{
    maven 'mv'
    }

    stages {
        stage("build") {
            steps {
                sh "mvn clean install"
            }
        }

        stage("test") {
            steps{
                sh "mvn test"
            }
        }
               stage("deploy") {
            steps {
           deploy adapters: [tomcat9(credentialsId: '5', path: '', url: 'http://35.197.41.139:8080')], contextPath: '/war1', war: '**/*.war'
            }
        }
}
node('a_node') {
    buildStep('Checkout'){
        checkout scm
    }

    buildStep('step 1'){
            sh '''echo "step 1"
            '''
    }

    setBuildStatus("Build complete", "SUCCESS");
}

void buildStep(String message, Closure closure) {
  stage(message);
  try {
    setBuildStatus(message, "PENDING");
    closure();
  } catch (Exception e) {
    setBuildStatus(message, "FAILURE");
  }
}

void setBuildStatus(String message, String state) {
  step([
      $class: "GitHubCommitStatusSetter",
      reposSource: [$class: "ManuallyEnteredRepositorySource", url: "https://github.com/my-org/my-repo"],
      contextSource: [$class: "ManuallyEnteredCommitContextSource", context: "ci/jenkins/build-status"],
      errorHandlers: [[$class: "ChangingBuildStatusErrorHandler", result: "UNSTABLE"]],
      statusResultSource: [ $class: "ConditionalStatusResultSource", results: [[$class: "AnyBuildResult", message: message, state: state]] ]
  ]);
}
}